<meta http-equiv='cache-control' content='no-cache'> 
<meta http-equiv='expires' content='0'> 
<meta http-equiv='pragma' content='no-cache'>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!DOCTYPE html>
<html>
<head>
<title> enVisionMagazine </title>
<link href="css/styleVM.css" rel="stylesheet" type="text/css">
<!-- <script type="text/javascript" src="js/indexVM.js"></script> -->
<style>

h1 {
    font-size: 30px;
    font-weight: 700;
    color: #35B851;
    margin-bottom: 44%;
}

h2 {
    font-size: 25px;
    font-weight: 400;
    color: #35B851;
    margin-top: -1%;
    margin-left: 15%;
    transform: rotate(2deg);
}

h3 {
    font-size: 22px;
    font-weight: 700;
    color: #575757;
    width: 66%;
}

h4 {
    font-size: 20px;
    font-weight: 400;
    color: #F8F8F8;
    background-color: #35B851;
    padding: 3%;
}

h5 {
    font-size: 17px;
    font-weight: 400;
    color: #575757;
    border-bottom: 1px solid #575757;
    padding: 3%;
}

p {
    font-size: 19px;
    color: #000000;
}

.articles {
    width: 25%;   /* container width */
    margin-left: 7%;
}

.arti {
    position: relative;
    width: 160%;
    padding: 2% 2% 5% 5%;
    margin-bottom: 55%;
    box-sizing: border-box;
}

/* Partial borders */
.arti::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 33%;
    height: 33%;
    border-top: 2px solid #35b851;
    border-left: 2px solid #35b851;
    box-sizing: border-box;
}

.arti::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 0;
    width: 33%;
    height: 33%;
    border-right: 2px solid #575757;
    border-bottom: 2px solid #575757;
    box-sizing: border-box;
}

.tag {
    position: absolute;
    top: -12px;
    left: -2px;
    background: #FCED3A;
    color: #575757;
    padding: 2px 10px;
    font-size: 0.75rem;
    border-radius: 3px;
    font-weight: bold;
    z-index: 2;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

.arti img {
    position: absolute;
    width: 25%;
    border-radius: 5%;
    box-shadow: 0 2px 4px rgba(0,0,0,0.33);
    margin-left: 70%;
    z-index: 0;
}

.arti a {
    color: #35b851;
    font-weight: 600;
}

.arti p {
    z-index: 1;
    position: relative;
}

.arti a {
    color: #35b851;
    font-weight: 600;
}

</style>
</head>
    <body>
        <header>
             <div class="logo">
                <img src="images/enVisionG.png">
            </div>
            <img src="images/menu.png" id="menu-icon" alt="Menu">
            <nav>
                <a href="enVisionMagazine.html"> Home </a>
                <a href="about.html"> About </a>
                <a href="#contact"> Contact </a>
            </nav>
            <form action="search.html" method="get">
                <button type="submit" class="searchButton"> <img src="images/searchIcon.svg"></button>
                <input type="text" name="query" placeholder="Search...">
            </form>
       </header>

<!-- Hidden menu content -->
<div id="mobile-menu">
    <a href="enVisionMagazine.html">Home</a>
    <a href="about.html">About</a>
    <a href="#contact">Contact</a>
</div>

<h2> Digital Magazine For Diverse Topics </h2>
<section class="allContent">
    <div class="list">
        <h4> Humanities </h4>
            <a href="spirituality&philosophy.html"><h5> Spirituality & Philosophy </h5></a>
            <a href="languages.html"><h5> Languages </h5></a>
            <a href="history.html"><h5> History </h5></a>
            <a href="geography.html"><h5> Geography </h5></a>
            <a href="politics.html"><h5> Politics </h5></a>
            <a href="arts.html"><h5> Arts </h5></a>
        <h4> Science </h4>
            <a href="biology.html"><h5> Biology </h5></a>
            <a href="health.html"><h5> Health </h5></a>
            <a href="chemistry.html"><h5> Chemistry </h5></a>
            <a href="mathematics.html"><h5> Mathematics </h5></a>
            <a href="physics.html"><h5> Physics </h5></a>
            <a href="astronomy.html"><h5> Astronomy </h5></a>
            <a href="technology.html"><h5> Technology </h5></a>
            <a href="social.html"><h5> Social Sciences </h5></a>
            <a href="economics.html"><h5> Economics </h5></a>
        <h4> Others </h4>
            <a href="sports.html"><h5> Sports </h5></a>
            <a href="hobbies.html"><h5> Hobbies </h5></a>
            <a href="travel.html"><h5> Travel </h5></a>
            <a href="food.html"><h5> Food </h5></a>
    </div>
  
    <div class="articles">
    <h1>Search Results</h1>
    <div id="results"></div>

    <script type="module">
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB_aEQJrZILdy2JYl6HbLwT43myJhVJH6g",
            authDomain: "envision-ed5f3.firebaseapp.com",
            projectId: "envision-ed5f3",
            storageBucket: "envision-ed5f3.appspot.com",
            messagingSenderId: "202691344541",
            appId: "1:202691344541:web:2f6c93e7f5138adf127c74",
            measurementId: "G-3NB50YD8F0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const params = new URLSearchParams(window.location.search);
        const query = params.get("query")?.toLowerCase() || "";

        // ✅ Set <h1> text dynamically
        const heading = document.querySelector(".articles h1");
        if (query) {
        heading.textContent = `Search Results for "${query}"`;
        } else {
        heading.textContent = "Search Results";
        }

        const resultsDiv = document.getElementById("results");

        const topicCollectionMap = {
            "geography": ["geography-articles", "geography1-articles"],
            "history": ["history-articles", "history1-articles"],
            "languages": ["languages-articles", "languages1-articles"],
            "biology": ["biology-articles", "biology1-articles"],
            "health": ["health-articles", "health1-articles"],
            "technology": ["technology-articles", "technology1-articles"],
            "sports": ["sports-articles", "sports1-articles"],
            "hobbies": ["hobbies-articles", "hobbies1-articles"],
            "travel": ["travel-articles", "travel1-articles"],
            "food": ["food-articles", "food1-articles"],
            "spirituality & philosophy": ["spirituality&philosophy-articles", "spirituality&philosophy1-articles"],
            "politics": ["politics-articles", "politics1-articles"],
            "arts": ["arts-articles", "arts1-articles"],
            "chemistry": ["chemistry-articles", "chemistry1-articles"],
            "mathematics": ["mathematics-articles", "mathematics1-articles"],
            "physics": ["physics-articles", "physics1-articles"],
            "astronomy": ["astronomy-articles", "astronomy1-articles"],
            "social sciences": ["social-articles", "social1-articles"],
            "economics": ["economics-articles", "economics1-articles"],
        };

        async function searchArticles() {
            let allArticles = [];

            // fetch all articles
            for (const topic in topicCollectionMap) {
                const colNames = topicCollectionMap[topic]; // now an array
                for (const colName of colNames) {
                    const snapshot = await getDocs(collection(db, colName));
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        allArticles.push({
                            id: doc.id,
                            collection: colName,
                            title: data.title || "",
                            body: data.body || "",
                            topic: data.topic || topic,
                            imageUrl: data.imageUrl || "images/magazine.png",
                            link: data.link || null // keep null if no Firebase link
                        });
                    });
                }
            }

            const filtered = allArticles.filter(a =>
                a.title.toLowerCase().includes(query) ||
                a.body.toLowerCase().includes(query) ||
                a.topic.toLowerCase().includes(query)
            );

            resultsDiv.innerHTML = "";

            if (!query) {
                resultsDiv.innerHTML = "<p>Please type something in the search box.</p>";
                return;
            } else if (filtered.length === 0) {
                resultsDiv.innerHTML = "<p>No results found.</p>";
                return;
            }

            // dynamically create HTML like your static .arti
            filtered.forEach(a => {
                const artiDiv = document.createElement("div");
                artiDiv.className = "arti";

                const tagDiv = document.createElement("div");
                tagDiv.className = "tag";
                tagDiv.textContent = a.topic;

                const img = document.createElement("img");
                img.src = a.imageUrl;

                const h3 = document.createElement("h3");
                h3.textContent = a.title;

                const p = document.createElement("p");
                const words = (a.body || "").split(" ").slice(0, 15).join(" ");
                
                // decide link: Firebase link or internal article page
                const link = a.link 
                    ? `<a href="${a.link}" target="_blank">Read More</a>`
                    : `<a href="enVisionMagazine-article.html?id=${a.id}&collection=${encodeURIComponent(a.collection)}">Read More</a>`;

                p.innerHTML = `${words}${(a.body && a.body.split(" ").length > 15 ? "..." : "")} <br> ${link}`;

                artiDiv.append(tagDiv, img, h3, p);
                resultsDiv.appendChild(artiDiv);
            });
        }

        searchArticles();

        // js/indexVM.js
        document.addEventListener("DOMContentLoaded", function () {
            console.log("indexVM.js loaded ✅");

            const resultsDiv = document.getElementById("results");

            // Apply margin to all current images
            const initialImages = resultsDiv.querySelectorAll(".arti img");
            initialImages.forEach((img) => {
                if (img.complete) {
                    applyMargin(img);
                } else {
                    img.onload = () => applyMargin(img);
                }
            });

            // Watch for new images being added dynamically
            const observer = new MutationObserver(() => {
                const images = resultsDiv.querySelectorAll(".arti img");
                images.forEach((img) => {
                    if (!img.dataset.adjusted) {
                        if (img.complete) {
                            applyMargin(img);
                        } else {
                            img.onload = () => applyMargin(img);
                            img.onerror = () =>
                                console.error("Image failed:", img.src);
                        }
                    }
                });
            });

            observer.observe(resultsDiv, { childList: true, subtree: true });

            // Create image with fallback
            function createArticleImage(article, artiDiv) {
                const img = document.createElement("img");
                img.src = article.imageUrl || "images/magazine.png";

                img.onerror = () => {
                    img.src = "images/magazine.png";
                };

                artiDiv.appendChild(img);

                if (img.complete) {
                    applyMargin(img);
                } else {
                    img.addEventListener("load", () => applyMargin(img));
                }
            }

            // Margin logic
            function applyMargin(img) {
                if (img.dataset.adjusted) return;

                const width = img.naturalWidth;
                const height = img.naturalHeight;

                if (height > width) {
                    img.style.marginTop = "-27%";
                    console.log("portrait applied:", img.src);
                } else if (width > height) {
                    img.style.marginTop = "-10%";
                    console.log("landscape applied:", img.src);
                } else {
                    img.style.marginTop = "-15%";
                    console.log("square applied:", img.src);
                }

                img.dataset.adjusted = "true";
            }
        });
    </script>

</div>

    <div class="stories">
        <h1 class="storiesTitle"> Top Stories</h1>
        <a href="enVisionMagazine-l3.html" onclick="localStorage.setItem('activeStory', 'charles-dickens');" style="text-decoration: none; color: inherit;">
            <div class="str strTop" data-id="charles-dickens">
                <h3> Charles Dickens </h3>
                <p> 
                    Charles Dickens (1812-1870) was a renowned English novelist and social critic, widely regarded as one of the greatest writers of the Victorian era. 
                </p> 
            </div>
        </a>
        <a href="enVisionMagazine-py3.html" onclick="localStorage.setItem('activeStory', 'light-speed');" style="text-decoration: none; color: inherit;">
            <div class="str strR" data-id="light-speed">
                <h3> Light Speed </h3>
                <p> 
                    Light travels through space at a constant speed of approximately 186,282 miles per second (299,792 kilometers per second) in a vacuum.
                </p>  
            </div>
        </a>
        <a href="enVisionMagazine-b3.html" onclick="localStorage.setItem('activeStory', 'bees-life');" style="text-decoration: none; color: inherit;">
            <div class="str strR" data-id="bees-life"> 
                <h3> Bees Life </h3>
                <p> 
                    Bees are fascinating insects with complex and highly organized social lives. 
                </p> 
            </div>
        </a>
        <div class="str strR">
            <h3><a href="writing-article.html"> Write Your Article.. </a></h3>
        </div>
    </div>
    
</section>
<!-- Footer -->

<footer>
<p> Copyright innovi 2022 - 2025 </p>
<div class="socials">
    <img src="images/facebookHover.png" class="facebookIcon">
    <img src="images/x.png" class="xIcon">
    <img src="images/youtube.png" class="youtubeIcon">
</div>
<p> info.-envision@innovi.com </p>
</footer>

<!-- Footer -->
  
	<script type="module" src="js/stories.js"></script>

	</body>
</html>